<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:wfv="com.wefootball.validators.*" 
	styleName="content" >
	<mx:Metadata>
		[Event(name="messageSend", type="com.wefootball.events.MessageDetailEvent")]
		[Event(name="freindRequestCreation", type="com.wefootball.events.UserEvent")]
		[Event(name="sendTeamJoinInvitation", type="com.wefootball.events.UserEvent")]
	</mx:Metadata>
	<mx:Script>
		<![CDATA[
			import com.wefootball.model.User;
    		import mx.rpc.events.ResultEvent;
    		import mx.rpc.events.FaultEvent;
    		import mx.collections.ArrayCollection;
    		import com.wefootball.events.MessageDetailEvent;
    		import com.wefootball.events.UserEvent;

 			[Bindable]
			public var user:User = null;
			public function set userId(i:String):void {
				user = null;
				getUserInfoRemote(i);
			}
			public function refresh():void {
				if (user != null && user.id != "") getUserInfoRemote(user.id);
			}
			private function getUserInfoRemote(id:String):void {
  				User.show(id,
						  handleSuccess,
						  handleFault);
			}
			private function handleSuccess(u:User, event:ResultEvent):void {
   				user = u;
			}
			private function handleFault(event:FaultEvent):void {
			}
			
			public function sendMessage():void {
				if (user != null && user.id != "") 
					dispatchEvent(new MessageDetailEvent(
						"messageSend",
						User.currentUser.id, 
						User.currentUser.nickname, user.id, user.nickname))
			}
			public function addAsFriend():void {
				if (user != null && user.id != "") 
					dispatchEvent(new UserEvent(
						"freindRequestCreation", user.id))
			}
			public function inviteAsTeamMember():void{
				if (user != null && user.id != "") 
					dispatchEvent(new UserEvent("sendTeamJoinInvitation", user.id))				
			}
			
			private var _foottotext:Object = {
				'L':'左脚', 'R':'右脚', 'B':'左右开弓'
			}
			private function foottotext(f:String):String {
				return _foottotext[f]
			}
			private var _postotext:Object = {
				'GK':'门将', 'SW':'清道夫', 'CB':'中后卫', 'LB':'左后卫',
				'RB':'右后卫', 'DM':'后腰', 'CM':'中前卫', 'LM':'左前卫',
				'RM':'右前卫', 'AM':'前腰', 'SS':'前锋', 'CF':'中锋'
			}
			internal function postotext(f:String):String {
				return _postotext[f]
			}
			
			private function canAddAsFriend(imf:Boolean):Boolean {
				if (user == null) return false;
				return user.id != User.currentUser.id && !user.ismyfriend
			}		
			private function canRemoveFromFriend(imf:Boolean):Boolean {
				if (user == null) return false;
				return (user.id != User.currentUser.id) && (user.ismyfriend)
			}
		]]>
	</mx:Script>
	
	<mx:Form labelWidth="100" width="100%">
		<mx:FormItem label="昵称" >
			<mx:Label text="{user.nickname}"/>
		</mx:FormItem>
		<mx:FormItem label="身高" >
			<mx:Label text="{user.height>0 ? user.height+'cm' : ''}"/>
		</mx:FormItem>
		<mx:FormItem label="体重" >
			<mx:Label text="{user.weight>0 ? user.weight+'kg' : ''}" />
		</mx:FormItem>
	    <mx:FormItem label="生日" >
	        <mx:Label text="{df.format(user.birthday)}" />
	    </mx:FormItem>
		<mx:FormItem label="惯用脚" >
			<mx:Label text="{foottotext(user.fitfoot)}" />
	    </mx:FormItem>
	    <mx:FormItem label="适合的位置" >
			<mx:TileList dataProvider="{user.positions}"  
				borderStyle="none" width="300" height="80"
				columnCount="4" textAlign="left">
				<mx:itemRenderer>
					<mx:Component>
						<mx:CheckBox label="{outerDocument.postotext(data.toString())}" selected="true" mouseEnabled="false" />
					</mx:Component>
				</mx:itemRenderer>
			</mx:TileList>
	    </mx:FormItem>
	    <mx:FormItem label="个人简介" >
	   	   	<mx:Text text="{user.summary}" width="100%" height="50%"/>   
	    </mx:FormItem>
	    <mx:FormItem direction="horizontal">
	    	<mx:Button label="发信" click="sendMessage()" visible="{user.id != User.currentUser.id}" />
	    	<mx:Button label="加为好友" click="addAsFriend()"
	    		visible="{canAddAsFriend(user.ismyfriend)}" />
	    	<mx:Button label="删除好友"
	    		visible="{canRemoveFromFriend(user.ismyfriend)}" />
	    	<mx:Button label="邀请入队" click="inviteAsTeamMember()" visible="{user.id != User.currentUser.id}"/>	    	
	    </mx:FormItem>
	</mx:Form>
	<mx:DateFormatter id="df" formatString="YYYY-MM-DD" />
</mx:VBox>

