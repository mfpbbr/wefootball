<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns="*" xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:msg="com.wefootball.components.message.*" xmlns:acc="com.wefootball.components.account.*"
	xmlns:tm="com.wefootball.components.team.*" xmlns:fri="com.wefootball.components.friend.*"
	height="100%" 
	paddingLeft="20" paddingRight="20" paddingTop="20" paddingBottom="20"
	creationComplete="init()">
	
<mx:Metadata>
	[Event(name="teamDisplay", type="com.wefootball.events.TeamDetailEvent")]
</mx:Metadata>

<mx:Script>
<![CDATA[
	import com.wefootball.components.team.TeamCreateBox;
	import mx.core.IFlexDisplayObject;
	import com.wefootball.model.Message;
	import com.wefootball.events.*;
	import mx.controls.Alert;
	import com.wefootball.model.User;
	import com.wefootball.components.message.MessageSendBox;
	import com.wefootball.components.team.TeamCreateBox;
	import com.wefootball.components.team.TeamBox;
	import com.wefootball.components.friend.FriendInvitationApplyBox;
	import mx.managers.PopUpManager;
	
	private var messageSendBox:MessageSendBox = new MessageSendBox;
	private var newTeamWindow:TeamCreateBox = new TeamCreateBox;
	private var requestSendBox:FriendInvitationApplyBox = new FriendInvitationApplyBox;
	
 	private function init():void
	{	
		initPopupWindow(requestSendBox);
		initPopupWindow(messageSendBox);
		initPopupWindow(newTeamWindow);
	}
	private function initPopupWindow(dis:IFlexDisplayObject):void {
		PopUpManager.addPopUp(dis, this);
		PopUpManager.centerPopUp(dis);
		dis.visible = false;
	}
	
	private function sendMessage(m:MessageDetailEvent):void {
		messageSendBox.visible=true;
		messageSendBox.message = m.message;
	}
	private function sendRequest(u:UserEvent):void {
		requestSendBox.visible=true;
		requestSendBox.hostId = u.user_id;
	}
	
	[Bindable]
	private var displayuser:User = new User();	
	private function userDisplay(u:UserEvent):void {
		personMainStack.selectedChild = userInformationPage;
		this.displayuser.id = u.user_id
	}
 	private function handleIndexChange():void
	{
		if(personMainStack.selectedChild == myFriendListPage)
			friendListBox.userId=User.currentUser.id;
		else if (personMainStack.selectedChild == userInformationPage)
			userInformationBox.userId = displayuser.id
	} 
]]>
</mx:Script>
		<mx:ApplicationControlBar width="200" height="100%" 
			paddingLeft="20" paddingRight="20" paddingTop="20" paddingBottom="20" >
			<mx:VBox height="100%" width="100%" >
				<mx:LinkButton label="我的信息" click="personMainStack.selectedChild = myInformationPage"/>
				<mx:LinkButton label="我的球队" click="personMainStack.selectedChild = myTeamPage"/>
				<mx:LinkButton label="我的信箱" click="personMainStack.selectedChild = myMessagePage"/>
				<mx:LinkButton label="我的邀请" click="personMainStack.selectedChild = myFriendInvitationPage"/>	
				<mx:LinkButton label="我的好友" click="personMainStack.selectedChild = myFriendListPage"/>	
				<!--<mx:LinkButton label="我的设置" click="settingWindow.visible = true;"/>-->
				<!--<mx:LinkButton label="新建球队" click="newTeamWindow.visible = true;"/>-->
			</mx:VBox>
		</mx:ApplicationControlBar>
		<mx:ApplicationControlBar width="700" height="100%" paddingTop="20" paddingBottom="20" >
			<mx:ViewStack id="personMainStack" width="100%" height="100%" change= "handleIndexChange()">
				<mx:VBox width="100%" height="100%" id="myInformationPage"
					paddingLeft="20" paddingRight="20" paddingBottom="20" >
					<mx:Label text="我的信息" styleName="head"/>
					<acc:InformationBox height="100%" user="{User.currentUser}"/>
				</mx:VBox>
				<mx:VBox width="100%" height="100%" id="myMessagePage"
					paddingLeft="20" paddingRight="20" paddingBottom="20" >
					<mx:Label text="我的信箱" styleName="head"/>
					<msg:MessageBox height="100%"  messageReply="sendMessage(event)" userDisplay="userDisplay(event)"/>
				</mx:VBox>
				<mx:VBox width="100%" height="100%" id="myTeamPage"
					paddingLeft="20" paddingRight="20" paddingBottom="20" >
					<mx:Label text="我的球队" styleName="head"/>
					<tm:TeamBox height="100%"/>
				</mx:VBox>
				<mx:VBox width="100%" height="100%" id="myFriendInvitationPage"
					paddingLeft="20" paddingRight="20" paddingBottom="20" >
					<mx:Label text="我的邀请" styleName="head"/>
					<fri:FriendInvitationListBox id="friendInvitationListBox"/>
				</mx:VBox>
				<mx:VBox width="100%" height="100%" id="myFriendListPage"
					paddingLeft="20" paddingRight="20" paddingBottom="20" >
					<mx:Label text="我的好友" styleName="head"/>
					<fri:FriendListBox id="friendListBox" userDisplay="userDisplay(event)"/>
				</mx:VBox>
				<mx:VBox width="100%" height="100%" id="userInformationPage"
					paddingLeft="20" paddingRight="20" paddingBottom="20" >
					<mx:Label text="{userInformationBox.user.nickname}的信息" styleName="head"/>
					<acc:InformationBox height="100%" messageSend="sendMessage(event)"
					 freindRequestCreation="sendRequest(event)" id="userInformationBox" />
				</mx:VBox>
			</mx:ViewStack>
		</mx:ApplicationControlBar>
</mx:HBox>