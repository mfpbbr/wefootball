<div id="narrow_right_content">
  <div class="sect">
    <h2></h2>
    <%=render :partial=>'sidebar_menu'%>
  </div>
</div>

<div id="wide_left_content">
  <div class="sect">
  <h2><%=h @title%></h2>
  <table>
    <tr>
      <td><%= team_icon(@another_team)%></td>
      <td style="width:100%">
        <table class="match_invitation_list">
          <tr>
            <td>
              <%= @host_team == @team ? '本队' : '对方'%>
              <%=link_to h(@host_team.shortname), team_view_path(@host_team)%>发起的邀请
            </td>
          </tr>
          <tr>
            <td>
              <%=link_to h(@another_team.shortname), team_view_path(@another_team)%>提出建议后，等待我队的回复
            </td>
          </tr>
          <%msg = @team == @host_team ? @unmodified_match_invitation.guest_team_message: @unmodified_match_invitation.host_team_message%>
          <%if !msg.blank?%>
          <tr>
            <td>
              对方的留言: 
              <%= h(msg)%>
            </td>
          </tr>
          <%end%>
        </table>
        <br/>
      </td>
      <td><%= team_icon(@self_team)%></td>
    </tr>
  </table>
  <br/>
  <br/>
  <%= error_messages_for :match_invitation %>

  <% form_for @match_invitation do |f| %>
    <%= f.hidden_field :guest_team_id,  :value=>@guest_team.id%>
    <%= f.hidden_field :host_team_id,  :value=>@host_team.id%>
    <table class="form match_invitation_list">
      <tr>
        <td style="width:60px">&nbsp;</td>
        <td>提出新建议</td>
        <td>对方提出的建议</td>
        <td>我队上次提出的建议</td>
      </tr>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '时间', :start_time, 
        Proc.new{ |t| 
              %(#{t.strftime('%Y-%m-%d %H:%M')}
                #{"(已过期)" if @unmodified_match_invitation.outdated?}
              )
          }, 
        Proc.new{ f.datetime_select :new_start_time, 
          :start_year => Date.today.year, :end_year => 1.year.since.year, :use_month_numbers => true, :minute_step=>15 })
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '地点', :location, 
        Proc.new{ |t| h t}, 
        Proc.new{ f.text_field :new_location })
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '比赛性质', :match_type, 
        Proc.new{ |t| match_type_text t}, 
        Proc.new{ f.select :new_match_type, MatchInvitation::MATCH_TYPES.map {|t| [match_type_text(t), t]}})
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '人数', :size, 
        Proc.new{ |t| "#{t}人制"}, 
        Proc.new{
          "#{f.select :new_size, MatchInvitation::MATCH_SIZES}人制"
        })
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '半场时间', :half_match_length, 
        Proc.new{ |t| "#{t}分钟"}, 
        Proc.new{ "#{f.text_field :new_half_match_length, :size=>1}分钟"})
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '中场休息', :rest_length, 
        Proc.new{ |t| "#{t}分钟"}, 
        Proc.new{ "#{f.text_field :new_rest_length, :size=>1}分钟"})
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '裁判', :has_judge, 
        Proc.new{ |t| t ? '有' : '没有'}, 
        Proc.new {
          %(
            #{f.radio_button :new_has_judge, true}有
            #{f.radio_button :new_has_judge, false}没有
        )})
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '红黄牌', :has_card, 
        Proc.new{ |t| t ? '有' : '没有'}, 
        Proc.new{
          %(
            #{f.radio_button :new_has_card, true}有
            #{f.radio_button :new_has_card, false}没有
        )})
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '越位', :has_offside, 
        Proc.new{ |t| t ? '有' : '没有'}, 
        Proc.new{
          %(
            #{f.radio_button :new_has_offside, true}有
            #{f.radio_button :new_has_offside, false}没有
        )})
      %>
      <%= macth_invitation_comparison_form_tr(@unmodified_match_invitation, '平局后', :win_rule, 
        Proc.new{ |t| win_rule_text t}, 
        Proc.new{ f.select :new_win_rule, MatchInvitation::WIN_RULES.map {|r| [win_rule_text(r), r]}})
      %>
    </table>

    <p>
      比赛说明<br />
      <%= f.text_area :new_description, :cols => 40, :rows => 10 %>
    </p>

    <p>
      给对方管理员的留言<br />
      <%if @unmodified_match_invitation.edit_by_host_team%>
        <%= f.text_area :host_team_message, :value=>'', :cols => 40, :rows => 3 %>
      <%else%>
        <%= f.text_area :guest_team_message, :value=>'',  :cols => 40, :rows => 3 %>
      <%end%>
    </p>

    <p>
      <%= f.submit "提出新建议" %>
    </p>
  <% end %>
  </div>
</div>

<div class="clearBoth"></div>