<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns="*" xmlns:mx="http://www.adobe.com/2006/mxml" width="100%"
	height="100%" label="Messege List" xmlns:msg="com.wefootball.components.message.*">

<mx:Metadata>
	[Event(name="messageDetail", type="com.wefootball.events.MessageDetailEvent")]
</mx:Metadata>

	   <mx:Script>
    	<![CDATA[
    		import com.wefootball.events.MessageDetailEvent;
    		import mx.controls.Alert;
    		import mx.rpc.events.ResultEvent;
    		import com.wefootball.events.MessageEvent;
    		
    		[Bindable]
    		public var messageInfo:XML;
    		
    		internal function readMessageInv(selectedRow:Object):void{
    		}
    		
    		internal function deleteMessage(data:Object):void{
    			svcMessageDestory.url = "/messages/" + data.id + ".xml";
    			svcMessageDestory.send({_method:"DELETE"});
    			Alert.show();
    		}
     		public function listMessages():void{
     			svcMessageList.send();
     		}
     		private function handleMessageList(event:ResultEvent):void{
     			//Alert.show(svcMessageList.lastResult.toString());
     		} 	
     		
     		private function handleMessageDestoryResult(event:ResultEvent):void{
     			if (event.result == "error") {
					Alert.show("The task was not successfully deleted.","Error");
				} else {
					Alert.show("Delete successful");
					listMessages();
				}
			}
     	
     		
     		internal function messageDetail(data:Object):void{
     			this.messageInfo = XML(data);
     			dispatchEvent(new MessageDetailEvent());
     		}	  		
     		
     		
    	]]>
    </mx:Script>

	<mx:HTTPService
	    id="svcMessageDestory"
	    resultFormat="e4x"
	    method="POST"
	    result="handleMessageDestoryResult(event)"
	/>
	
	<mx:HTTPService
	    id="svcMessageList"
	    url="/messages.xml"
	    resultFormat="e4x"
	    method="GET"
	    result="handleMessageList(event)"
	/>
	<mx:XMLListCollection id="messagesReceiveXLC"
  	  source="{svcMessageList.lastResult['as_receiver']['message']}"/>
	<mx:XMLListCollection id="messagesSendXLC"
  	  source="{svcMessageList.lastResult['as_sender']['message']}"/>
	
    <mx:TabNavigator id="tn"  width="100%" height="100%">
    <!-- Define each panel using a VBox container. -->
    <mx:VBox id= "recieveBox" label="收件箱">
       <!-- <msg:RecieveMessageBox id="recieveMessageBox"/>-->
        <mx:Form labelWidth="100">
		<mx:DataGrid initialize="listMessages()" dataProvider="{messagesReceiveXLC}" width="670" rowCount="10">
			<mx:columns>
				<mx:DataGridColumn headerText="From" dataField="sender_id">
					<mx:itemRenderer>
						<mx:Component>
							<mx:LinkButton label="{data.sender_id}" click="outerDocument.messageDetail(data)"/>
						</mx:Component>
					</mx:itemRenderer>
				</mx:DataGridColumn>
				<mx:DataGridColumn headerText="To" dataField="receiver_id"/>
				<mx:DataGridColumn headerText="Subject" dataField="subject" width="300"/>
				<mx:DataGridColumn headerText="">
	        		<mx:itemRenderer>
	        			<mx:Component>
	        				<mx:Button label="查看"  click="outerDocument.messageDetail(data)"/>
	        			</mx:Component>
	        		</mx:itemRenderer>
        		</mx:DataGridColumn>
	        	<mx:DataGridColumn headerText="">
	        		<mx:itemRenderer>
	        			<mx:Component>
	        				<mx:Button label="删除" click="outerDocument.deleteMessage(data)"/>
	        			</mx:Component>
	        		</mx:itemRenderer>
        		</mx:DataGridColumn>        	
			</mx:columns>		
		</mx:DataGrid>
		<mx:Button id="cleanReceiveButton" 
				label="Clean This Box"/>
		</mx:Form>
    </mx:VBox>
    <mx:VBox id= "sendBox" label="发件箱">
       <!-- <msg:SendMessageBox id="sendMessageBox"/>-->
       <mx:Form labelWidth="100">
		<mx:DataGrid initialize="listMessages()" dataProvider="{messagesSendXLC}" width="670" rowCount="10">
			<mx:columns>
				<mx:DataGridColumn headerText="From" dataField="sender_id"/>
				<mx:DataGridColumn headerText="To" dataField="receiver_id"/>
				<mx:DataGridColumn headerText="Subject" dataField="subject" width="300"/>
				<mx:DataGridColumn headerText="">
	        		<mx:itemRenderer>
	        			<mx:Component>
	        				<mx:Button label="查看"  click="outerDocument.messageDetail(data)"/>
	        			</mx:Component>
	        		</mx:itemRenderer>
        		</mx:DataGridColumn>
	        	<mx:DataGridColumn headerText="">
	        		<mx:itemRenderer>
	        			<mx:Component>
	        				<mx:Button label="删除" click="outerDocument.deleteMessage(data)"/>
	        			</mx:Component>
	        		</mx:itemRenderer>
        		</mx:DataGridColumn>        	
			</mx:columns>		
		</mx:DataGrid>
		<mx:Button id="ClearSendButton" 
				label="Clean This Box" />
		</mx:Form>
    </mx:VBox>
    </mx:TabNavigator>
        

</mx:VBox>