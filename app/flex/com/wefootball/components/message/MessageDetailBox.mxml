<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%"
	height="100%">
<mx:Metadata>
	[Event(name="messageReply", type="com.wefootball.events.MessageDetailEvent")]
</mx:Metadata>
<mx:Script>
<![CDATA[
	import mx.controls.Alert;
	import mx.rpc.events.ResultEvent;
	import mx.rpc.events.FaultEvent;
	import com.wefootball.events.MessageDetailEvent;
	import com.wefootball.events.MessageDisplayEvent;
	import com.wefootball.model.Message;
	import com.wefootball.model.User;
	
	[Bindable]
    public var message:Message;
	public function set messageId(i:String):void {
		message = null
		displayMessageDetail(i);
	}	
	private function messageReply():void {
		dispatchEvent(new MessageDetailEvent(
			"messageReply",
			message.receiver_id,
			message.receiver_nick,
			message.sender_id,
			message.sender_nick,
			"re: "+message.subject
		));
	}
	
	internal function displayMessageDetail(mid:String):void{
    	Message.show(mid,
     		handleMessageDetailResult,
     		handleMessageFaultDetailResult);
    }
  	private function handleMessageDetailResult(m:Message, event:ResultEvent):void{
   		this.message = m
 	}
 	private function handleMessageFaultDetailResult(event:FaultEvent):void{
 		Alert.show("Get detail failed"); 			
 	}	
]]>

</mx:Script>
			
	<mx:Form>
		<mx:FormItem label="From">
			<mx:Text width="100%" text="{message.sender_nick}"/>
		</mx:FormItem>
		<mx:FormItem label="To">
			<mx:Text width="100%" text="{message.receiver_nick}" />
		</mx:FormItem>
		<mx:FormItem label="Subject">
			<mx:Text width="100%" text="{message.subject}"/>
		</mx:FormItem>
		<mx:FormItem label="Content" >
			<mx:Text text="{message.content}" width="285" height="100"/>
	    </mx:FormItem>
		<mx:FormItem>
			<mx:Button label="Reply Message" 
				 click="messageReply()"
				 visible="{User.currentUser.id != message.sender_id}"
				 creationComplete="event.target.visible = false"
			/>
		</mx:FormItem>
	</mx:Form>
</mx:VBox>